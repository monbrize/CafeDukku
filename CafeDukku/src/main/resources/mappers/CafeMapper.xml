<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.caduk.mapper.CafeMapper">
	<insert id="createCafe" parameterType="CafeVO">
		insert into cafe(cafeid, idx, cafename, cafename2, inform, notice, sns_url, call, postcode, loc1, loc2, status)
		values(cafeid_seq.nextval, #{idx}, #{cafename}, #{cafename2:VARCHAR},#{inform:VARCHAR}, #{notice:VARCHAR},
		 #{sns_url:VARCHAR}, #{call:VARCHAR},#{postcode:VARCHAR}, #{loc1:VARCHAR}, #{loc2:VARCHAR}, 'O')  
	</insert>
	<update id="updateOwner" parameterType="int">
		update member set roll='OWNER' where idx=#{val}
	</update>
	<select id="viewCafe" parameterType="int" resultType="CafeVO">
		select * from cafe where cafeid=#{val}
	</select>
	<select id="viewMyCafe" parameterType="int" resultType="CafeVO">
		select * from cafe where idx=#{val}
	</select>
	
	<update id="updateCafe" parameterType="CafeVO" >
		update cafe set cafename=#{cafename}, cafename2=#{cafename2:VARCHAR}, inform=#{inform:VARCHAR}, notice=#{notice:VARCHAR},
			sns_url=#{sns_url:VARCHAR}, call=#{call:VARCHAR}, postcode=#{postcode:VARCHAR}, loc1=#{loc1:VARCHAR}, loc2=#{loc2:VARCHAR}
			where cafeid=#{cafeid}
	</update>
	<select id="getSearchCafe"  parameterType="String" resultType="CafeVO">
		select c.cafeid, c.cafename, c.cafename2, i.img_name from cafe c join cafe_img i on c.cafeid=i.cafeid
		where (c.cafename like '%'||#{val}||'%' or c.cafename2 like '%'||#{val}||'%') and i.img_type='logo'
	</select>
	<select id="getAllCafe" resultType="CafeVO">
		select c.cafeid, c.cafename, c.cafename2, i.img_name 
		from cafe c join cafe_img i on c.cafeid=i.cafeid
		where i.img_type='logo'
	</select>
	<select id="getCafebyTag" parameterType="String" resultType="CafeVO">
	select c.cafeid cafeid, c.cafename cafename, c.cafename2 cafename2, i.img_name img_name from cafe c join cafe_img i on c.cafeid=i.cafeid
		where i.img_type='logo' and c.cafeid in (select cafeid from cafe_tag where tag_name=#{val})
	</select>
	 
	<!-- eval -->
	<insert id="evalCafe" parameterType="EvaluationVO">
		insert into eval_cafe(rateid, cafeid, ordertime, idx, kindness, clean, mood, price, comfort, restroom)
		values(rateid_seq.nextval, #{cafeid}, sysdate, #{idx}, #{kindness}, #{clean}, #{mood},
		#{price}, #{comfort},#{restroom})
		
	</insert>
	<!-- 태그  -->
	<select id="cafeTag" resultType="CafeVO">
		select tag_type, tag_name from cafe_tag where cafeid=#{cafeid}
	</select>
	<insert id="addTag" parameterType="CafeVO">
		insert into cafe_tag(cafeid, tag_type, tag_name) values(#{cafeid}, #{tag_type}, #{tag_name})
	</insert>
	<delete id="removeTag" parameterType="CafeVO">
		delete from cafe_tag where cafeid=#{cafeid} and tag_type=#{tag_type} and tag_name=#{tag_name}
	</delete>
	<!-- 이미지-->
	<insert id="addImg" parameterType="CafeVO">
		insert into cafe_img values(imgid_seq.nextval, #{cafeid}, #{img_type}, #{img_name}, #{img_name_origin})
	</insert>
	<select id="cafeImg" resultType="CafeVO">
		select imgid, img_type, img_name, img_name_origin from cafe_img where cafeid=#{cafeid}
	</select>
	<select id="cafeImgbyId" resultType="CafeVO">
		select imgid, img_type, img_name, img_name_origin from cafe_img where imgid=#{val}
	</select>
	<delete id="removeImg">
		delete from cafe_img where imgid=#{val}
	</delete>
</mapper>